name: Simple Deploy Test

on:
  workflow_dispatch:

jobs:
  test-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Simple SSH Deploy
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.CAFE24_HOST }}
        username: ${{ secrets.CAFE24_USERNAME }}
        password: ${{ secrets.CAFE24_PASSWORD }}
        port: ${{ secrets.CAFE24_PORT }}
        script: |
          cd /home/hosting_users/${{ secrets.CAFE24_USERNAME }}/www
          echo "ðŸ§ª ê°„ë‹¨í•œ ë°°í¬ í…ŒìŠ¤íŠ¸..."
          
          # í”„ë¡œì„¸ìŠ¤ ì •ë¦¬
          pkill -f "node" 2>/dev/null || true
          
          # ì½”ë“œ ì—…ë°ì´íŠ¸
          git pull origin main
          
          # ì„¤ì¹˜ ë° ë¹Œë“œ
          npm install
          npm run build
          
          # ì„œë²„ ì‹œìž‘
          NODE_ENV=production PORT=3000 nohup npm start > simple.log 2>&1 &
          
          sleep 3
          echo "âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ" 