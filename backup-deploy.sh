#!/bin/bash

# ê°„ë‹¨í•œ ë°±ì—… ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
echo "ğŸš€ í¬ë ˆë”§ìŠ¤í† ë¦¬ ê°„ë‹¨ ë°°í¬ ì‹œì‘..."

# 1. ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ (ìˆë‹¤ë©´)
echo "ğŸ”„ ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ..."
pkill -f "next start" || echo "ì‹¤í–‰ ì¤‘ì¸ Next.js ì„œë²„ê°€ ì—†ìŠµë‹ˆë‹¤."

# 2. ìµœì‹  ì½”ë“œ ì—…ë°ì´íŠ¸
echo "ğŸ“¥ ìµœì‹  ì½”ë“œ ì—…ë°ì´íŠ¸..."
git pull origin main

# 3. ì˜ì¡´ì„± ì„¤ì¹˜
echo "ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜..."
npm install

# 4. ë¹Œë“œ
echo "ğŸ—ï¸ í”„ë¡œë•ì…˜ ë¹Œë“œ..."
npm run build

# 5. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
echo "ğŸ”§ í™˜ê²½ë³€ìˆ˜ ì„¤ì •..."
export NODE_ENV=production
export PORT=3000

# 6. ì„œë²„ ì‹œì‘ (ë°±ê·¸ë¼ìš´ë“œ)
echo "ğŸš€ ì„œë²„ ì‹œì‘..."
nohup npm start > server.log 2>&1 &

# 7. PID ì €ì¥
echo $! > server.pid

echo "âœ… ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
echo "ğŸ“ ë¡œê·¸: tail -f server.log"
echo "ğŸ›‘ ì„œë²„ ì¢…ë£Œ: kill \$(cat server.pid)" 